<!DOCTYPE html>
<html>
    <head>
        <title>Title</title>
    </head>
    <body>
        <script>
            var path = document.location.pathname.substring(0,document.location.pathname.lastIndexOf("/"));
            var repo = path.substring(1, path.length);
            if(repo.indexOf("/") > 0) repo = repo.substring(0,repo.indexOf("/"));
            var dir = path.substring(repo.length+1,path.length);
            console.log("Path =" + path);
            console.log("Repository = " + repo);
            console.log("Directory = " + dir);

            (async () => {
                var api = "https://api.github.com/repos/diggsml/" + repo + "/contents/docs"+dir;
                const response = await fetch(api);
                const data = await response.json();
                let txt = "<h1>Index of " + path + "</h1>";
                txt += '<table>';
                txt += '<tr><th valign="top"><img src="https://diggsml.org/'+ repo + '/icons/blank.gif" alt="[ICO]"></th><th><a href="?C=N;O=D">Name</a></th><th><a href="?C=M;O=A">Last Modified</a></th></tr>';
                txt += '<tr><th colspan="3"><hr></th></tr>';
                txt += '<tr><td valign="top"><img src="https://diggsml.org/'+ repo + '/icons/back.gif" alt="[PARENTDIR]"></td><td><a href="../">Parent Directory</a></td><td align="right">  - </td><</tr>';
     
                for (let rec of data) {
                    if(rec.name == "scripts") continue;
                    if(rec.name == "icons") continue;
                    if(rec.name == "stylesheets") continue;
                    if(rec.name == "index.html") continue;
                    if(rec.name == "img") continue;
                    if(rec.type == "file") var image ='<img src="icons/unknown.gif" alt="[   ]">';
                    if(rec.type == "dir") image ='<img src="https://diggsml.org/'+ repo + '/icons/folder.gif" alt="[DIR]">';

                     let commitapi = "https://api.github.com/repos/diggsml/" + repo + "/commits?path=docs" + dir + "/" + rec.name + "&page=1&per_page=1";
                     (async () => {
                          const response = await fetch(commitapi);
                          const dat = await response.json();
                          for (let dt of dat) {
                            const d = new Date(dt.commit.author.date);
                            let dString = d.toLocaleString();
                           }
                         })()
                         txt += '<tr><td valign="top">'+image+'</td><td><a href="'+rec.name+'">'+rec.name+'</a></td><td>'+dString+'</td></tr>';
 
                }
                txt += '</table>';
                document.getElementsByTagName('body')[0].innerHTML = txt;
      })()